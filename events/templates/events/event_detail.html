<!--# events/templates/events/event_detail.html-->
{% extends "./main_template.html" %}
{% load static %}

{% block content %}

<div class="card rounded-pill" style="max-height: 210px; ">
    <div class="row g-0">
        <div class="col-4">
            <img alt="Organisation logo" class="img-thumbnail float-start rounded-pill border-0"
                 src="{{ event.organisation.logo.url }}" style="max-height: 200px;"/>
        </div>
        <div class="col-8 align-self-center text-end pe-4">
            <div class="card-body">
                <h5 class="display-5">{{ event.organisation.name }}</h5>
            </div>
        </div>
    </div>
</div>

<div class="container">
    <div class="row d-flex text-center text-light border-2 border-bottom p-5 mb-3">
        <h2 class="display-6">{{ event.event_title }}</h2>
        <p class="mb-0 mx-auto lead">{{ event.date }}</p>
    </div>
</div>

<div class="container text-light mb-3">
    <h3 class="py-3">Pizza Orders:</h3>
    {% if pizza_orders %}
    {% for pizza_order in pizza_orders %}
    <div class="card w-100 mb-3">
        <div class="card-body">
            <div class="row">
                <div class="col">
                    <h5 class="card-title">{{ pizza_order.purchaser_name }}</h5>
                </div>
                <div class="col text-end">
                    <h5 class="card-title">{{ pizza_order.pizza_type }}</h5>
                </div>
            </div>
            <div class="row text-muted">
                <div class="col">
                    <small class="mb-0">Revolut: {{ pizza_order.purchaser_revolut }}</small>
                </div>
                <div class="col text-end">
                    <small class="mb-0">Slices: {{ pizza_order.available_slices }} @
                        ‚Ç¨{{pizza_order.price_per_slice|floatformat:2 }}</small>
                </div>
            </div>
            <div class="row text-muted mb-3">
                <small>WhatsApp: {{ pizza_order.purchaser_whatsapp }}</small>
            </div>
            <div class="container pb-3">
                {% for slice in pizza_order.matched_slices %}
                {% if forloop.first %}
                <div class="row small text-uppercase text-secondary mb-2">
                    <div class="col">
                        Name
                    </div>
                    <div class="col">
                        WhatsApp
                    </div>
                    <div class="col text-end">
                        Slices
                    </div>
                </div>
                {% endif %}
                <div class="row small mb-2">
                    <div class="col-4">
                        {{ slice.buyer_name }}
                    </div>
                    <div class="col-6">
                        {{ slice.buyer_whatsapp }}
                    </div>
                    <div class="col-2 text-end">
                        x{{ slice.number_of_slices }}
                        {% if not pizza_order.event_is_locked %}
                        <a aria-label="Close"
                           class="btn-close m-2"
                           href="{% url 'events:delete-slices' event.organisation.path slice.id %}?next={{ request.path|urlencode }}"
                           id="remove-slices"></a>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>

            <div class="container text-center mb-3">
                {% for x in ""|ljust:pizza_order.get_total_claimed %}
                ‚úîÔ∏è
                {% endfor %}
                {% for x in ""|ljust:pizza_order.get_total_remaining %}
                üçï
                {% endfor %}
            </div>

            <div class="d-grid ">
                {% if pizza_order.event_is_locked %}
                <a class="btn btn-outline-danger rounded-pill text-center disabled" href="" id="new-slices-locked"
                   role="button">Event
                    Locked</a>
                {% elif pizza_order.get_total_remaining > 0 %}
                <a class="btn btn-outline-danger rounded-pill text-center"
                   href="{% url 'events:claim-slices' event.organisation.path pizza_order.id %}?next={{ request.path|urlencode }}"
                   id="join-order-btn"
                   role="button">
                    Join Order</a>
                {% else %}
                <a class="btn btn-outline-danger text-center disabled" href="" id="order-full" role="button">Order
                    Full</a>
                {% endif %}
            </div>
        </div>
    </div>

    {% endfor %}
    {% else %}
    <p>Nobody has offered to order yet for this event</p>
    {% endif %}

    <div class="d-grid mb-5">
        {% if event.locked %}
        <a class="btn rounded-pill text-center disabled" href="" id="new-orders-locked" role="button">Event Locked</a>
        {% else %}
        <a class="btn btn-outline-light rounded-pill text-center"
           href="{% url 'events:create-pizza-order' event.organisation.path event.id %}?next={{ request.path|urlencode }}"
           id="create-order-btn"
           role="button">Start a new pizza order</a>
        {% endif %}
    </div>
</div>
{% endblock %}